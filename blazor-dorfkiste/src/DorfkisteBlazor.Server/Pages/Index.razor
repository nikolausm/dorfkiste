@page "/"
@using DorfkisteBlazor.Application.Features.Items.DTOs
@inject NavigationManager Navigation
@inject IJSRuntime JSRuntime

<PageTitle>Dorfkiste - Teile und leihe in deiner Nachbarschaft</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge">
    <!-- Hero Section - eBay Style -->
    <MudPaper Class="hero-section pa-6 mb-4" Elevation="0" Style="background: linear-gradient(135deg, #f7f7f7 0%, #ffffff 100%); border: 1px solid #e5e5e5; border-radius: 8px;">
        <MudContainer MaxWidth="MaxWidth.Large" Class="text-center">
            <MudText Typo="Typo.h3" Class="mb-3 font-weight-bold" Style="color: #0064d2;">
                Willkommen bei Dorfkiste
            </MudText>
            <MudText Typo="Typo.h6" Class="mb-5" Style="color: #707070;">
                Ihre Nachbarschaftsplattform zum Teilen und Leihen
            </MudText>
            <div class="d-flex gap-3 justify-center flex-wrap">
                <MudButton Href="/items"
                           Variant="Variant.Filled" 
                           Color="Color.Primary"
                           Size="Size.Large"
                           StartIcon="@Icons.Material.Filled.Search"
                           Class="ebay-primary-button">
                    Artikel entdecken
                </MudButton>
                <AuthorizeView>
                    <Authorized>
                        <MudButton Href="/items/new"
                                   Variant="Variant.Outlined" 
                                   Color="Color.Primary"
                                   Size="Size.Large"
                                   StartIcon="@Icons.Material.Filled.Add"
                                   Class="ebay-secondary-button">
                            Artikel einstellen
                        </MudButton>
                    </Authorized>
                    <NotAuthorized>
                        <MudButton Href="/auth/signup"
                                   Variant="Variant.Outlined" 
                                   Color="Color.Primary"
                                   Size="Size.Large"
                                   StartIcon="@Icons.Material.Filled.PersonAdd"
                                   Class="ebay-secondary-button">
                            Kostenlos registrieren
                        </MudButton>
                    </NotAuthorized>
                </AuthorizeView>
            </div>
        </MudContainer>
    </MudPaper>

    <!-- Features Section - eBay Style -->
    <MudGrid Class="mb-6" Spacing="3">
        <MudItem xs="12" md="4">
            <MudCard Class="ebay-feature-card pa-5 text-center h-100" Elevation="0">
                <MudIcon Icon="@Icons.Material.Filled.Nature" 
                         Size="Size.Large" 
                         Color="Color.Primary" 
                         Class="mb-3" />
                <MudText Typo="Typo.h6" Class="mb-2 font-weight-medium" Style="color: #0064d2;">
                    Nachhaltig leben
                </MudText>
                <MudText Typo="Typo.body2" Style="color: #707070; line-height: 1.4;">
                    Reduziere deinen ökologischen Fußabdruck durch Teilen statt Kaufen. 
                    Gemeinsam für eine nachhaltigere Zukunft.
                </MudText>
            </MudCard>
        </MudItem>
        
        <MudItem xs="12" md="4">
            <MudCard Class="ebay-feature-card pa-5 text-center h-100" Elevation="0">
                <MudIcon Icon="@Icons.Material.Filled.People" 
                         Size="Size.Large" 
                         Color="Color.Primary" 
                         Class="mb-3" />
                <MudText Typo="Typo.h6" Class="mb-2 font-weight-medium" Style="color: #0064d2;">
                    Nachbarschaft stärken
                </MudText>
                <MudText Typo="Typo.body2" Style="color: #707070; line-height: 1.4;">
                    Lerne deine Nachbarn kennen und baue starke Gemeinschaften auf. 
                    Zusammen sind wir stärker.
                </MudText>
            </MudCard>
        </MudItem>
        
        <MudItem xs="12" md="4">
            <MudCard Class="ebay-feature-card pa-5 text-center h-100" Elevation="0">
                <MudIcon Icon="@Icons.Material.Filled.Savings" 
                         Size="Size.Large" 
                         Color="Color.Primary" 
                         Class="mb-3" />
                <MudText Typo="Typo.h6" Class="mb-2 font-weight-medium" Style="color: #0064d2;">
                    Geld sparen
                </MudText>
                <MudText Typo="Typo.body2" Style="color: #707070; line-height: 1.4;">
                    Warum kaufen, wenn du leihen kannst? Spare Geld und Platz, 
                    während du anderen hilfst.
                </MudText>
            </MudCard>
        </MudItem>
    </MudGrid>

    <!-- Popular Categories - eBay Style -->
    <MudText Typo="Typo.h5" Class="mb-3 font-weight-medium" Style="color: #0064d2;">
        Beliebte Kategorien
    </MudText>
    <MudGrid Class="mb-6" Spacing="2">
        @foreach (var category in _popularCategories)
        {
            <MudItem xs="6" sm="4" md="3" lg="2">
                <MudButton Href="@($"/items?category={category.Slug}")"
                           Variant="Variant.Outlined"
                           Class="ebay-category-button pa-3 w-100 h-100"
                           Style="flex-direction: column; border-radius: 8px; border-color: #e5e5e5;">
                    <MudIcon Icon="@category.Icon" Size="Size.Medium" Color="Color.Primary" Class="mb-2" />
                    <MudText Typo="Typo.caption" Class="text-center" Style="color: #0064d2; font-weight: 500;">
                        @category.Name
                    </MudText>
                </MudButton>
            </MudItem>
        }
    </MudGrid>

    <!-- Recent Items Preview - eBay Style -->
    <MudText Typo="Typo.h5" Class="mb-3 font-weight-medium" Style="color: #0064d2;">
        Neueste Artikel
    </MudText>
    
    <div class="recent-items-preview mb-5">
        <ItemGrid Items="_recentItems" ShowPagination="false" />
    </div>

    <div class="text-center">
        <MudButton Href="/items"
                   Variant="Variant.Outlined"
                   Color="Color.Primary"
                   Size="Size.Large"
                   EndIcon="@Icons.Material.Filled.ArrowForward"
                   Class="ebay-view-all-button">
            Alle Artikel anzeigen
        </MudButton>
    </div>
</MudContainer>

@code {
    private List<CategoryItem> _popularCategories = new();
    private List<ItemDto> _recentItems = new();

    protected override async Task OnInitializedAsync()
    {
        LoadPopularCategories();
        await LoadRecentItems();
    }
    
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                await JSRuntime.InvokeVoidAsync("console.log", "UI-Dev: Initializing Index page");
                await JSRuntime.InvokeVoidAsync("console.log", "UI-Dev: Index page initialized with hero section and item preview");
            }
            catch (Exception ex)
            {
                // Log exception but don't throw - this is for debugging only
                Console.WriteLine($"JS Interop failed: {ex.Message}");
            }
        }
    }

    private void LoadPopularCategories()
    {
        _popularCategories = new List<CategoryItem>
        {
            new() { Name = "Werkzeuge", Icon = Icons.Material.Filled.Build, Slug = "werkzeuge" },
            new() { Name = "Garten", Icon = Icons.Material.Filled.Grass, Slug = "garten" },
            new() { Name = "Elektronik", Icon = Icons.Material.Filled.ElectricalServices, Slug = "elektronik" },
            new() { Name = "Sport", Icon = Icons.Material.Filled.SportsBasketball, Slug = "sport" },
            new() { Name = "Haushalt", Icon = Icons.Material.Filled.Home, Slug = "haushalt" },
            new() { Name = "Bücher", Icon = Icons.Material.Filled.MenuBook, Slug = "buecher" }
        };
    }

    private async Task LoadRecentItems()
    {
        try
        {
            // Mock data for demonstration - replace with actual API call
            _recentItems = new List<ItemDto>
            {
                new()
                {
                    Id = Guid.NewGuid(),
                    Title = "Profi-Bohrmaschine",
                    Description = "Leistungsstarke Bohrmaschine für alle Materialien",
                    Condition = "Sehr gut",
                    PricePerDay = 15.00m,
                    Location = "Berlin Mitte",
                    Available = true,
                    CategoryName = "Werkzeuge",
                    Images = new List<ItemImageDto> 
                    { 
                        new() { Id = Guid.NewGuid(), Url = "/images/drill.jpg", Order = 1 } 
                    },
                    CreatedAt = DateTime.Now.AddDays(-1),
                    UserId = Guid.NewGuid(),
                    CategoryId = Guid.NewGuid(),
                    PickupAvailable = true,
                    DeliveryAvailable = false
                },
                new()
                {
                    Id = Guid.NewGuid(),
                    Title = "Gartenmöbel Set",
                    Description = "Schönes Gartenmöbel-Set für 6 Personen",
                    Condition = "Gut",
                    PricePerDay = 25.00m,
                    Location = "Hamburg",
                    Available = true,
                    CategoryName = "Garten",
                    Images = new List<ItemImageDto> 
                    { 
                        new() { Id = Guid.NewGuid(), Url = "/images/furniture.jpg", Order = 1 } 
                    },
                    CreatedAt = DateTime.Now.AddDays(-2),
                    UserId = Guid.NewGuid(),
                    CategoryId = Guid.NewGuid(),
                    PickupAvailable = true,
                    DeliveryAvailable = true
                }
            };
        }
        catch (Exception ex)
        {
            await JSRuntime.InvokeVoidAsync("console.error", "Error loading recent items:", ex.Message);
        }
    }

    private class CategoryItem
    {
        public string Name { get; set; } = string.Empty;
        public string Icon { get; set; } = string.Empty;
        public string Slug { get; set; } = string.Empty;
    }

    // Using shared ItemDto from DorfkisteBlazor.Server.Shared.Dtos
}

<style>
    /* eBay-Style Hero Section */
    .hero-section {
        position: relative;
        background: #f7f7f7;
        border: 1px solid #e5e5e5;
        border-radius: 8px;
    }

    .ebay-primary-button {
        background-color: #0064d2 !important;
        border: none !important;
        border-radius: 18px !important;
        font-weight: 600 !important;
        text-transform: none !important;
        padding: 8px 24px !important;
        transition: all 0.2s ease !important;
    }
    
    .ebay-primary-button:hover {
        background-color: #004c9c !important;
        transform: translateY(-1px);
    }

    .ebay-secondary-button {
        border-color: #0064d2 !important;
        color: #0064d2 !important;
        border-radius: 18px !important;
        font-weight: 500 !important;
        text-transform: none !important;
        padding: 8px 24px !important;
        transition: all 0.2s ease !important;
    }
    
    .ebay-secondary-button:hover {
        background-color: rgba(0, 100, 210, 0.04) !important;
        border-color: #004c9c !important;
        color: #004c9c !important;
    }

    /* eBay-Style Feature Cards */
    .ebay-feature-card {
        border: 1px solid #e5e5e5;
        border-radius: 8px;
        background: white;
        transition: all 0.2s ease;
    }
    
    .ebay-feature-card:hover {
        border-color: #0064d2;
        box-shadow: 0 2px 8px rgba(0, 100, 210, 0.1);
    }

    /* eBay-Style Category Buttons */
    .ebay-category-button {
        border: 1px solid #e5e5e5 !important;
        background: white !important;
        transition: all 0.2s ease !important;
        min-height: 100px;
        color: #0064d2 !important;
    }
    
    .ebay-category-button:hover {
        border-color: #0064d2 !important;
        background-color: rgba(0, 100, 210, 0.02) !important;
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(0, 100, 210, 0.1);
    }

    /* eBay-Style View All Button */
    .ebay-view-all-button {
        border-color: #0064d2 !important;
        color: #0064d2 !important;
        border-radius: 18px !important;
        font-weight: 500 !important;
        text-transform: none !important;
        padding: 10px 32px !important;
        transition: all 0.2s ease !important;
    }
    
    .ebay-view-all-button:hover {
        background-color: rgba(0, 100, 210, 0.04) !important;
        border-color: #004c9c !important;
        color: #004c9c !important;
        transform: translateY(-1px);
    }

    .recent-items-preview {
        max-width: 100%;
    }

    /* Responsive Design */
    @@media (max-width: 960px) {
        .hero-section {
            padding: 24px 16px !important;
        }
        
        .d-flex.gap-3 {
            gap: 12px !important;
            flex-direction: column;
        }
        
        .ebay-feature-card {
            padding: 24px 16px !important;
        }
        
        .ebay-category-button {
            min-height: 80px;
            padding: 12px !important;
        }
    }

    @@media (max-width: 600px) {
        .ebay-primary-button,
        .ebay-secondary-button {
            width: 100%;
            margin-bottom: 8px;
        }
    }
</style>